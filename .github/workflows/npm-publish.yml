name: "📦 Publish › NPM Package"
run-name: "📦 Publish › NPM Package"

on:
    workflow_dispatch:

jobs:

    # ---------------------------------------------------------------------------------------
    #   JOB > INITIALIZE
    # ---------------------------------------------------------------------------------------

    job-initialize:
        name: "📦 Publish › Initialize"
        runs-on: ubuntu-latest
        permissions:
            contents: read
            packages: write
        steps:

        # ---------------------------------------------------------------------------------------
        #   Job > Initialize > Checkout
        # ---------------------------------------------------------------------------------------

            - name: "☑️ Checkout"
              id: task-initialize-checkout
              uses: actions/checkout@v4

    # ---------------------------------------------------------------------------------------
    #   Job > Publish > NPMJS
    # ---------------------------------------------------------------------------------------

    job-publish-npm:
        name: "📦 Publish › NPM"
        needs: job-initialize
        runs-on: ubuntu-latest
        permissions:
            contents: read
            packages: write
        steps:

            # ---------------------------------------------------------------------------------------
            #   Job > Publish > Npmjs > Checkout
            # ---------------------------------------------------------------------------------------

            - name: "☑️ Checkout"
              id: task_npmjs_checkout
              uses: actions/checkout@v4

            # ---------------------------------------------------------------------------------------
            #   Job > Publish > Npmjs > Setup Node
            # ---------------------------------------------------------------------------------------

            - name: "⚙️ Setup Node"
              id: task_npmjs_node_setup
              uses: actions/setup-node@v4
              with:
                node-version: '20.x'
                registry-url: 'https://registry.npmjs.org/'
                always-auth: true
                scope: '@aetherinox'

            # ---------------------------------------------------------------------------------------
            #   Job > Publish > Npmjs > NPM Actions
            # ---------------------------------------------------------------------------------------

            - name: "📦 NPM Actions"
              id: task_npmjs_node_actions
              run: |
                npm ci
                npm publish
              env:
                NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}

    # ---------------------------------------------------------------------------------------
    #   Job > Publish > Github
    # ---------------------------------------------------------------------------------------

    job-publish-ghnpm:
        name: "📦 Publish › Github NPM"
        needs: job-initialize
        runs-on: ubuntu-latest
        permissions:
            contents: read
            packages: write
        steps:

            # ---------------------------------------------------------------------------------------
            #   Job > Publish > Github > Checkout
            # ---------------------------------------------------------------------------------------

            - name: "☑️ Checkout"
              id: task_ghnpm_checkout
              uses: actions/checkout@v4

            # ---------------------------------------------------------------------------------------
            #   Job > Publish > Github > Setup Node
            # ---------------------------------------------------------------------------------------

            - name: "⚙️ Setup Node"
              id: task_ghnpm_node_setup
              uses: actions/setup-node@v4
              with:
                node-version: '20.x'
                registry-url: https://npm.pkg.github.com/
                scope: '@aetherinox'

            # ---------------------------------------------------------------------------------------
            #   Job > Publish > Github > NPM Actions
            # ---------------------------------------------------------------------------------------

            - name: "📦 NPM Actions"
              id: task_ghnpm_node_actions
              run: |
                npm ci
                npm publish
              env:
                NODE_AUTH_TOKEN: ${{ secrets.SELF_TOKEN_CL }}
